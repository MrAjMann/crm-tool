<div class="fixed inset-0 bg-gray-600 bg-opacity-50 h-full w-full" id="modal-overlay">
    <!-- Modal -->
    <div class="relative top-10 mx-auto p-5 border max-w-5xl shadow-lg rounded-md bg-white" style="margin-top: 5%">
        <div class="text-center">
            <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">Add New Invoice</h3>
            <!-- Form -->
            <form id="invoiceForm" class="space-y-4" hx-post="/add-invoice/" hx-swap="beforeend">
                <div class="space-y-8">
                    <label for="customerSearch">Customer:</label>
                    <input type="text" id="customerSearch" class="w-full px-3 py-2 border rounded" placeholder="Start typing to search for a customer..." hx-get="/search-customers" hx-trigger="keyup changed" hx-target="#customerSearchResults" hx-swap="innerHTML" hx-params="search" name="search">
                    <div id="customerSearchResults"></div>
                    <!-- Results populated by HTMX on input -->
                </div>
			<div id="newInvoiceForm">
				<!-- Input Fields -->
				<input type="date" name="DueDate" id="invoice-DueDate" class="w-full px-3 py-2 border rounded" placeholder="Due Date" value="" />
				<input type="text" name="CustomerName" id="invoice-CustomerName" class="w-full px-3 py-2 border rounded" placeholder="Customer Name" />
				<input type="text" name="CompanyName" id="invoice-CompanyName" class="w-full px-3 py-2 border rounded" placeholder="Company Name" />
				<input type="text" name="CustomerPhone" id="invoice-CustomerPhone" class="w-full px-3 py-2 border rounded" placeholder="Customer Phone" />
				<input type="email" name="CustomerEmail" id="invoice-CustomerEmail" class="w-full px-3 py-2 border rounded" placeholder="Customer Email" />
			
				<!-- Items Section -->
				<div id="itemsSection">
					<h3 class="text-lg font-medium mb-2">Items</h3>
					<div class="item-row mb-4 grid grid-cols-8 gap-2">
						<input type="text" name="items[0].Item" class="col-span-2 px-3 py-2 border rounded" placeholder="Item" />
						<input type="number" name="items[0].Quantity" class="px-3 py-2 border rounded" placeholder="Quantity" />
						<input type="number" name="items[0].UnitPrice" class="px-3 py-2 border rounded" placeholder="Unit Price" />
						<input type="number" name="items[0].Subtotal" class="px-3 py-2 border rounded" placeholder="Subtotal" />
						<input type="number" name="items[0].Tax" class="px-3 py-2 border rounded" placeholder="Tax" />
						<input type="number" name="items[0].Total" class="px-3 py-2 border rounded" placeholder="Total" />
						<button type="button" class="add-item-btn  inline-flex items-center py-2 px-4 bg-green-500 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest  hover:bg-green-700 active:bg-green-700 focus:outline-none focus:border-green-700 focus:ring focus:ring-green-200 disabled:opacity-25 transition">Add Item</button>
					
					</div>
				</div>
	
				
			</div>
			
				<!-- Submit and Close Buttons -->
				<div class="space-y-4">
					<button
						type="submit"
						class="inline-flex items-center py-2 px-4 bg-blue-500 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-blue-700 active:bg-blue-700 focus:outline-none focus:border-blue-700 focus:ring focus:ring-blue-200 disabled:opacity-25 transition"
					>
						Submit
					</button>
					<button
						onclick="closeModal()"
						class="inline-flex items-center py-2 px-4 bg-red-500 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-red-700 active:bg-red-700 focus:outline-none focus:border-red-700 focus:ring focus:ring-red-200 disabled:opacity-25 transition"
					>
						Close
					</button>
				</div>
			</form>
		</div>
	</div>
</div>
<script>
    const itemsSection = document.getElementById('itemsSection');
    const addItemBtn = document.querySelector('.add-item-btn');
    let itemCount = 1;
    let items = [];

    addItemBtn.addEventListener('click', function() {
        const itemRow = document.querySelector('.item-row');
        const itemInputs = itemRow.querySelectorAll('input');
        const itemData = {
            Item: itemInputs[0].value,
            Quantity: itemInputs[1].value,
            UnitPrice: itemInputs[2].value,
            Subtotal: itemInputs[3].value,
            Tax: itemInputs[4].value,
            Total: itemInputs[5].value
        };

        items.push(itemData);

        const newItemRow = document.createElement('div');
        newItemRow.classList.add('item-row', 'mb-4', 'grid', 'grid-cols-8', 'gap-4');
        newItemRow.innerHTML = `
            <input type="text" name="items[${itemCount}].Item" class="col-span-2 px-3 py-2 border rounded" placeholder="Item" value="${itemData.Item}" />
            <input type="number" name="items[${itemCount}].Quantity" class="px-3 py-2 border rounded" placeholder="Quantity" value="${itemData.Quantity}" />
            <input type="number" name="items[${itemCount}].UnitPrice" class="px-3 py-2 border rounded" placeholder="Unit Price" value="${itemData.UnitPrice}" />
            <input type="number" name="items[${itemCount}].Subtotal" class="px-3 py-2 border rounded" placeholder="Subtotal" value="${itemData.Subtotal}" />
            <input type="number" name="items[${itemCount}].Tax" class="px-3 py-2 border rounded" placeholder="Tax" value="${itemData.Tax}" />
            <input type="number" name="items[${itemCount}].Total" class="px-3 py-2 border rounded" placeholder="Total" value="${itemData.Total}" />
            <button type="button" class="delete-item-btn inline-flex items-center py-2 px-4 bg-red-500 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-red-700 active:bg-red-700 focus:outline-none focus:border-red-700 focus:ring focus:ring-red-200 disabled:opacity-25 transition" data-item-index="${itemCount}">Delete</button>
        `;
        itemsSection.appendChild(newItemRow);
        itemCount++;

        // Clear the form inputs
        itemInputs.forEach(input => input.value = '');

        // Add event listener to delete buttons
        const deleteButtons = document.querySelectorAll('.delete-item-btn');
        deleteButtons.forEach(button => {
            button.addEventListener('click', function() {
                const itemIndex = this.dataset.itemIndex;
                items = items.filter((item, index) => index !== parseInt(itemIndex) - 1);
                this.parentNode.remove();
                updateItemRows();
            });
        });
    });

    function updateItemRows() {
        const itemRows = document.querySelectorAll('.item-row');
        itemRows.forEach((row, index) => {
            const inputs = row.querySelectorAll('input');
            const deleteButton = row.querySelector('.delete-item-btn');
            inputs.forEach(input => {
                input.name = `items[${index}].${input.placeholder}`;
            });
            deleteButton.dataset.itemIndex = index + 1;
        });
    }
</script>
<script>document.getElementById('customerSearch').addEventListener('keyup', function() {
    console.log(this.value);  // This should log the current input value on keyup
});</script>
